# ==================== APPLICATION INFO ====================
spring.application.name=transaction-service
server.port=9083

# ==================== DATABASE CONFIGURATION ====================
spring.datasource.url=jdbc:postgresql://localhost:5432/velocityx_transactions
spring.datasource.username=postgres
spring.datasource.password=root
spring.datasource.driver-class-name=org.postgresql.Driver

# HikariCP Configuration
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name=TransactionServiceHikariPool

# JPA Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# ==================== REDIS CONFIGURATION ====================
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=
spring.data.redis.timeout=60000
spring.cache.type=redis
spring.cache.redis.time-to-live=900000

# ==================== KAFKA CONFIGURATION ====================
# Bootstrap Servers
spring.kafka.bootstrap-servers=localhost:9092

# Producer Configuration
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.enable.idempotence=true
spring.kafka.producer.properties.max.in.flight.requests.per.connection=5

# Consumer Configuration
spring.kafka.consumer.group-id=transaction-service-group
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.properties.spring.json.trusted.packages=*

# Kafka Topics
kafka.topics.transaction-events=transaction-events
kafka.topics.wallet-events=wallet-events
kafka.topics.user-events=user-events
kafka.topics.notification-events=notification-events

# ==================== SECURITY CONFIGURATION ====================
# JWT Configuration
app.jwt.secret=dGhpc2lzYXZlcnlzZWN1cmVzZWNyZXRrZXl0aGF0aXNhdGxlYXN0MjU2Yml0c2xvbmdmb3JIUzI1NmFsZ29yaXRobQ==
app.jwt.access-token-expiration=900000
app.jwt.refresh-token-expiration=604800000

# CORS Configuration
app.cors.allowed-origins=http://localhost:3000,http://localhost:4200
app.cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
app.cors.allowed-headers=*
app.cors.allow-credentials=true

# ==================== ACTUATOR CONFIGURATION ====================
management.endpoints.web.exposure.include=health,info,metrics,prometheus,loggers,env,beans
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true
management.health.ratelimiters.enabled=true

# Metrics
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# ==================== DISTRIBUTED TRACING ====================
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=http://localhost:9411/api/v2/spans

# ==================== RESILIENCE4J CONFIGURATION ====================
# Circuit Breaker
resilience4j.circuitbreaker.instances.walletService.register-health-indicator=true
resilience4j.circuitbreaker.instances.walletService.sliding-window-size=10
resilience4j.circuitbreaker.instances.walletService.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.walletService.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.walletService.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.walletService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.walletService.slow-call-rate-threshold=50
resilience4j.circuitbreaker.instances.walletService.slow-call-duration-threshold=2s

resilience4j.circuitbreaker.instances.userService.register-health-indicator=true
resilience4j.circuitbreaker.instances.userService.sliding-window-size=10
resilience4j.circuitbreaker.instances.userService.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.userService.wait-duration-in-open-state=10s

# Retry
resilience4j.retry.instances.walletService.max-attempts=3
resilience4j.retry.instances.walletService.wait-duration=500ms
resilience4j.retry.instances.walletService.enable-exponential-backoff=true
resilience4j.retry.instances.walletService.exponential-backoff-multiplier=2

resilience4j.retry.instances.userService.max-attempts=3
resilience4j.retry.instances.userService.wait-duration=500ms

# Rate Limiter
resilience4j.ratelimiter.instances.transactionApi.limit-for-period=100
resilience4j.ratelimiter.instances.transactionApi.limit-refresh-period=1s
resilience4j.ratelimiter.instances.transactionApi.timeout-duration=0s

# Bulkhead
resilience4j.bulkhead.instances.walletService.max-concurrent-calls=10
resilience4j.bulkhead.instances.walletService.max-wait-duration=1s

# ==================== FEIGN CONFIGURATION ====================
spring.cloud.openfeign.client.config.default.connect-timeout=5000
spring.cloud.openfeign.client.config.default.read-timeout=10000
spring.cloud.openfeign.client.config.default.logger-level=full

# Service URLs
app.services.user-service.url=http://localhost:8080
app.services.wallet-service.url=http://localhost:8081
app.services.notification-service.url=http://localhost:8083

# ==================== LOGGING CONFIGURATION ====================
logging.level.root=INFO
logging.level.com.velocityx.transaction_service=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=INFO
logging.level.org.springframework.kafka=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Logback Configuration
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ==================== OPENAPI CONFIGURATION ====================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.tags-sorter=alpha
springdoc.show-actuator=true

# ==================== TRANSACTION SERVICE CONFIGURATION ====================
# Idempotency
app.transaction.idempotency.ttl-hours=24

# Transaction Limits
app.transaction.max-amount=1000000.00
app.transaction.min-amount=0.01

# Hold Transaction
app.transaction.hold.expiry-days=7

# Refund
app.transaction.refund.window-days=90

# ==================== JACKSON CONFIGURATION ====================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC
spring.jackson.default-property-inclusion=non_null

# ==================== EUREKA CLIENT ====================
eureka.client.service-url.defaultZone=http://admin:admin@localhost:8761/eureka/
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.instance.prefer-ip-address=true
eureka.instance.instance-id=${spring.application.name}:${random.value}