# ==================== APPLICATION ====================
spring.application.name=api-gateway
server.port=9080

# ==================== EUREKA CLIENT ====================
eureka.client.service-url.defaultZone=http://admin:admin@localhost:8761/eureka/
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.instance.prefer-ip-address=true
eureka.instance.instance-id=${spring.application.name}:${random.value}

# ==================== GATEWAY ROUTES ====================
# User Service
spring.cloud.gateway.routes[0].id=user-service
spring.cloud.gateway.routes[0].uri=lb://user-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/users/**
spring.cloud.gateway.routes[0].filters[0]=RewritePath=/api/users/(?<segment>.*), /${segment}
spring.cloud.gateway.routes[0].filters[1]=CircuitBreaker
spring.cloud.gateway.routes[0].filters[1].args.name=userServiceCircuitBreaker
spring.cloud.gateway.routes[0].filters[1].args.fallbackUri=forward:/fallback/user-service

# Transaction Service
spring.cloud.gateway.routes[1].id=transaction-service
spring.cloud.gateway.routes[1].uri=lb://transaction-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/transactions/**
spring.cloud.gateway.routes[1].filters[0]=RewritePath=/api/transactions/(?<segment>.*), /${segment}
spring.cloud.gateway.routes[1].filters[1]=CircuitBreaker
spring.cloud.gateway.routes[1].filters[1].args.name=transactionServiceCircuitBreaker
spring.cloud.gateway.routes[1].filters[1].args.fallbackUri=forward:/fallback/transaction-service

# Wallet Service
spring.cloud.gateway.routes[2].id=wallet-service
spring.cloud.gateway.routes[2].uri=lb://wallet-service
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/wallets/**
spring.cloud.gateway.routes[2].filters[0]=RewritePath=/api/wallets/(?<segment>.*), /${segment}
spring.cloud.gateway.routes[2].filters[1]=CircuitBreaker
spring.cloud.gateway.routes[2].filters[1].args.name=walletServiceCircuitBreaker
spring.cloud.gateway.routes[2].filters[1].args.fallbackUri=forward:/fallback/wallet-service

# Reward Service
spring.cloud.gateway.routes[3].id=reward-service
spring.cloud.gateway.routes[3].uri=lb://reward-service
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/rewards/**
spring.cloud.gateway.routes[3].filters[0]=RewritePath=/api/rewards/(?<segment>.*), /${segment}
spring.cloud.gateway.routes[3].filters[1]=CircuitBreaker
spring.cloud.gateway.routes[3].filters[1].args.name=rewardServiceCircuitBreaker
spring.cloud.gateway.routes[3].filters[1].args.fallbackUri=forward:/fallback/reward-service

# Notification Service
spring.cloud.gateway.routes[4].id=notification-service
spring.cloud.gateway.routes[4].uri=lb://notification-service
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/notifications/**
spring.cloud.gateway.routes[4].filters[0]=RewritePath=/api/notifications/(?<segment>.*), /${segment}
spring.cloud.gateway.routes[4].filters[1]=CircuitBreaker
spring.cloud.gateway.routes[4].filters[1].args.name=notificationServiceCircuitBreaker
spring.cloud.gateway.routes[4].filters[1].args.fallbackUri=forward:/fallback/notification-service

# ==================== GLOBAL FILTERS ====================
spring.cloud.gateway.default-filters[0]=DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origins=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=true

# ==================== REDIS (Rate Limiting) ====================
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.timeout=60000

# ==================== RATE LIMITING ====================
gateway.rate-limit.enabled=true
gateway.rate-limit.default-replenish-rate=100
gateway.rate-limit.default-burst-capacity=200
gateway.rate-limit.default-requested-tokens=1

# ==================== CIRCUIT BREAKER (Resilience4j) ====================
resilience4j.circuitbreaker.configs.default.sliding-window-size=10
resilience4j.circuitbreaker.configs.default.minimum-number-of-calls=5
resilience4j.circuitbreaker.configs.default.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.configs.default.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.configs.default.failure-rate-threshold=50
resilience4j.circuitbreaker.configs.default.slow-call-rate-threshold=50
resilience4j.circuitbreaker.configs.default.slow-call-duration-threshold=2s

# ==================== TIME LIMITER ====================
resilience4j.timelimiter.configs.default.timeout-duration=5s
resilience4j.timelimiter.configs.default.cancel-running-future=true

# ==================== SECURITY (JWT) ====================
app.jwt.secret=5367566B59703373367639792F423F4528482B4D6251655468576D5A71347437
app.jwt.expiration=86400000

# ==================== ACTUATOR ====================
management.endpoints.web.exposure.include=health,info,metrics,prometheus,gateway
management.endpoint.health.show-details=always
management.endpoint.gateway.enabled=true
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# ==================== DISTRIBUTED TRACING ====================
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=http://localhost:9411/api/v2/spans

# ==================== LOGGING ====================
logging.level.root=INFO
logging.level.com.velocityx.api_gateway=DEBUG
logging.level.org.springframework.cloud.gateway=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ==================== GATEWAY CONFIGURATION ====================
spring.cloud.gateway.httpclient.connect-timeout=5000
spring.cloud.gateway.httpclient.response-timeout=10s
spring.cloud.gateway.httpclient.pool.max-connections=500
spring.cloud.gateway.httpclient.pool.max-idle-time=30s

# ==================== OPENAPI ====================
springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
