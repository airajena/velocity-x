# ==================== APPLICATION INFO ====================
spring.application.name=notification-service
server.port=8083

# ==================== DATABASE CONFIGURATION ====================
spring.datasource.url=jdbc:postgresql://localhost:5432/velocityx_notifications
spring.datasource.username=postgres
spring.datasource.password=postgres
spring.datasource.driver-class-name=org.postgresql.Driver

# HikariCP Configuration
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=15
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name=NotificationServiceHikariPool

# JPA Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# ==================== REDIS CONFIGURATION ====================
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=
spring.data.redis.timeout=60000
spring.cache.type=redis
spring.cache.redis.time-to-live=900000

# ==================== KAFKA CONFIGURATION ====================
spring.kafka.bootstrap-servers=localhost:9092

# Producer Configuration
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.enable.idempotence=true
spring.kafka.producer.properties.max.in.flight.requests.per.connection=5

# Consumer Configuration
spring.kafka.consumer.group-id=notification-service-group
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.properties.spring.json.trusted.packages=*

# Kafka Topics
kafka.topics.notification-p0=notification-p0
kafka.topics.notification-p1=notification-p1
kafka.topics.notification-p2=notification-p2
kafka.topics.notification-rate-limit=notification-rate-limit
kafka.topics.notification-db-writes=notification-db-writes
kafka.topics.notification-retry=notification-retry
kafka.topics.notification-dlq=notification-dlq

# External Event Topics (from other services)
kafka.topics.transaction-events=transaction-events
kafka.topics.user-events=user-events
kafka.topics.wallet-events=wallet-events

# ==================== SECURITY CONFIGURATION ====================
app.jwt.secret=dGhpc2lzYXZlcnlzZWN1cmVzZWNyZXRrZXl0aGF0aXNhdGxlYXN0MjU2Yml0c2xvbmdmb3JIUzI1NmFsZ29yaXRobQ==
app.jwt.access-token-expiration=900000

# CORS Configuration
app.cors.allowed-origins=http://localhost:3000,http://localhost:4200
app.cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
app.cors.allowed-headers=*
app.cors.allow-credentials=true

# ==================== EMAIL CONFIGURATION ====================
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=your-email@gmail.com
spring.mail.password=your-app-password
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# ==================== ACTUATOR CONFIGURATION ====================
management.endpoints.web.exposure.include=health,info,metrics,prometheus,loggers
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true
management.health.ratelimiters.enabled=true

# Metrics
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# ==================== DISTRIBUTED TRACING ====================
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=http://localhost:9411/api/v2/spans

# ==================== RESILIENCE4J CONFIGURATION ====================
# Circuit Breaker for Webhooks
resilience4j.circuitbreaker.instances.webhookDelivery.register-health-indicator=true
resilience4j.circuitbreaker.instances.webhookDelivery.sliding-window-size=10
resilience4j.circuitbreaker.instances.webhookDelivery.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.webhookDelivery.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.webhookDelivery.failure-rate-threshold=50

# Retry for Webhooks
resilience4j.retry.instances.webhookDelivery.max-attempts=3
resilience4j.retry.instances.webhookDelivery.wait-duration=1s
resilience4j.retry.instances.webhookDelivery.enable-exponential-backoff=true
resilience4j.retry.instances.webhookDelivery.exponential-backoff-multiplier=2

# Rate Limiter for API
resilience4j.ratelimiter.instances.notificationApi.limit-for-period=100
resilience4j.ratelimiter.instances.notificationApi.limit-refresh-period=1s
resilience4j.ratelimiter.instances.notificationApi.timeout-duration=0s

# ==================== NOTIFICATION SERVICE CONFIGURATION ====================
# Priority Configuration
notification.priority.p0.name=CRITICAL
notification.priority.p0.max-rate-per-minute=1000
notification.priority.p0.consumer-threads=10

notification.priority.p1.name=DEFAULT
notification.priority.p1.max-rate-per-minute=500
notification.priority.p1.consumer-threads=5

notification.priority.p2.name=BULK
notification.priority.p2.max-rate-per-minute=100
notification.priority.p2.consumer-threads=3

# Retry Configuration
notification.retry.max-attempts=5
notification.retry.initial-delay-seconds=5
notification.retry.max-delay-seconds=3600
notification.retry.backoff-multiplier=2

# Webhook Configuration
notification.webhook.timeout-seconds=5
notification.webhook.slow-customer-threshold-ms=3000
notification.webhook.max-concurrent-per-customer=5

# DB Writer Configuration
notification.db-writer.batch-size=100
notification.db-writer.max-write-rate-per-second=500
notification.db-writer.flush-interval-ms=1000

# Rate Limiting (Redis-based)
notification.rate-limit.enabled=true
notification.rate-limit.window-seconds=60
notification.rate-limit.p0-limit=1000
notification.rate-limit.p1-limit=500
notification.rate-limit.p2-limit=100

# Email Template Configuration
notification.email.from=noreply@velocityx.com
notification.email.from-name=VelocityX
notification.email.templates-path=classpath:templates/email/

# ==================== LOGGING CONFIGURATION ====================
logging.level.root=INFO
logging.level.com.velocityx.notification_service=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=INFO
logging.level.org.springframework.kafka=INFO
logging.level.org.hibernate.SQL=DEBUG

# ==================== OPENAPI CONFIGURATION ====================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operations-sorter=method
springdoc.show-actuator=true

# ==================== JACKSON CONFIGURATION ====================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC
spring.jackson.default-property-inclusion=non_null
